### 非對稱式加密與中間人攻擊原理

* 對稱式加密：加密解密鑰匙同一把，有中間人拿到鑰匙就 GG 了。
* 非對稱式加密的鑰匙：是一組公鑰與私鑰。
* 可以生成自己的一組鑰匙：自己的公鑰、自己的私鑰。

> 可以用公鑰加密、私鑰解密；可以用私鑰加密、公鑰解密。

#### 要怎麼用呢？傳訊息給女友為例

> 公鑰加密、私鑰解密

準備：

1. 女友打鑰匙：女友公鑰、女友私鑰。
2. 我打鑰匙：我的公鑰、我的私鑰。
3. 互換公鑰：我有女友公鑰，女友有我公鑰

用法：
* 我傳訊息給女友要用女友給的```女友公鑰```加密，女友收到訊息用女友自己的```女友私鑰```解密

而這裡只有公鑰會先被傳給對方，被攔截也沒關係，也要有私鑰才可以解密。

#### 數位簽章：確定消息源是女友來的

> 私鑰加密、公鑰解密

假如大家都有我的公鑰，大家都可以發訊息給我，我要怎麼確定我收到的訊息是我女友發來的？

1. 女友先對本文 hash 一下產生摘要
2. 女友對摘要使用私鑰加密變成簽名
3. 女友再把簽名放到信件下方
4. 我用女友的公鑰解密他的簽名，產生摘要
5. 我對信件本文 hash 產生摘要
6. 我比對摘要有沒有不同，沒有不同就是女友發來的，沒有被修改

#### 中間人攻擊

前面提到，我跟女友雙方通訊使用非對稱加密，要先把公鑰給女友並女友也要把她公鑰給我，此時，有一位小三在一開始就擷取到我們兩個公鑰，那就會發生很可怕的一件事兒。

1. 我一開始要把公鑰丟給女友時，小三攔截我的公鑰，小三把自己的公鑰 001 給女友
2. 女友一開始要把公鑰給我時，小三攔截女友公鑰，小三也把自己另一個公鑰 002 給我
3. 我傳訊息給女友，不知情的用小三的 002 公鑰加密，然後我用了我的私鑰簽名
4. 小三攔截我的訊息後，用我的公鑰驗證是我的訊息，用小三 002 私鑰解密，然後看我的訊息，可能還會修改內容，然後用女友公鑰加密，用小三私鑰 001 加簽傳給女友

神不知鬼不覺！

#### CA 扮演的角色

為了知道我所拿到的女友公鑰到底是不是真的屬於女友的，要找一個公正單位也就是 CA: certification authority 來保證我拿到了是女友的公鑰，整個流程大概如下：

1. CA 用自己的私鑰對女友公鑰跟一些訊息加密，生成數字證書 (digital certificate)
2. 女友拿到數字證書後，可以除了簽名外，再附上數字證書，才發給我訊息
3. 我收到訊息後，用 CA 的公鑰解開數字證書，就拿到女友的公鑰
4. 拿到女友的公鑰，就能驗證女友數字簽名是不是真實的了

#### 補充

公私鑰產生流程 (使用 RSA 演算法)

1. 選擇任意兩個大的質數：p and q, p 不等於 q, N = pq
2. 尤拉函數 (Euler φ function)：φ(N) = φ(p)φ(q) = (p-1)(q-1)
3. 選一個小於 φ(N) 的整數 e, 使 e 與 φ(N) 互質，並求 e 與 φ(N) 模倒數：d
4. 刪除 p, q

> 公鑰：(N, e), 私鑰：(N, d)


參考文獻：
* [網路安全 (1) - 基礎密碼學]
* [RSA 加密演算法]
* [2019 年的人们如何生成 HTTPS 证书]
* [数字签名是什么？]

[数字签名是什么？]:http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html
[2019 年的人们如何生成 HTTPS 证书]:https://xiaoyue26.github.io/2019/04/14/2019-04/2019%E5%B9%B4%E7%9A%84%E4%BA%BA%E4%BB%AC%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90HTTPS%E8%AF%81%E4%B9%A6/
[網路安全 (1) - 基礎密碼學]:https://blog.techbridge.cc/2017/04/16/simple-cryptography/
[RSA 加密演算法]:https://zh.wikipedia.org/zh-tw/RSA%E5%8A%A0%E5%AF%86%E6%BC%94%E7%AE%97%E6%B3%95
